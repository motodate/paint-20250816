# ペイントアプリ（HTML版）要件定義書 v0.3（叩き台・更新：左側ツールバー集約）

---

## 1. 背景・目的

* **目的**: ブラウザ上で動作するシンプルなペイントツールを提供し、手軽なラフスケッチや注釈用途を可能にする。
* **価値仮説**: インストール不要・軽量・学習コストが低いことで、社内外の素早いビジュアルコミュニケーションに貢献。

## 2. スコープ（範囲）

* **対象**: デスクトップ/タブレットの主要ブラウザでの手描きスケッチ。
* **含む**: ペンツール、消しゴムツール、ペン太さ変更、**キャンバス全消去（クリア）**、**画像ダウンロード（PNGエクスポート）**、**左側ツールバーでの集約UI**。
* **含まない（今回）**: レイヤー、図形描画、テキスト、Undo/Redo、マルチページ、共同編集、サーバ保存。

## 3. ペルソナ/主要ユースケース（仮）

* **ペルソナ**:

  * 企画・デザイナーがワイヤーのラフを描く
  * エンジニアが仕様の図を簡易に共有
* **ユースケース**:

  1. ペンで描く→消しゴムで修正→**保存（PNGダウンロード）**
  2. 会議中にタブレットでホワイトボード代替（終了時に**クリア**）

## 4. 用語定義（簡易）

* **キャンバス**: HTML5 `<canvas>` 2Dコンテキスト。
* **ペン**: 不透明の自由曲線描画。
* **消しゴム**: 描画済みピクセルの削除（透明化）または背景色での上書き。
* **左側ツールバー（サイドバー）**: 画面左端に固定された縦型操作領域。ツール切替・太さ調整・クリア・保存を集約。

## 5. 機能要件（MoSCoW）

### 5.1 Must（必須）

1. **ペンツールでの自由曲線描画**

   * 入力: マウス・タッチ・ペン（Pointer Events）。
   * **色**: 黒固定（#000）\[要確認]。
   * **太さ**: スライダーで 1–30 px（既定 4 px）\[要確認]。
   * 線の継ぎ目・端部: 丸型（round join/cap）。
2. **消しゴムツール**

   * 動作: **合成モード=destination-out** による透明消去（背景透過）を採用 \[要確認]。
   * **太さ**: スライダーで 5–50 px（既定 20 px）\[要確認]。
3. **左側ツールバーでの操作集約**

   * **配置**: 画面左端に固定。**ペン／消しゴム／太さスライダー／全消去／ダウンロード** を縦並びに配置。
   * **順序（上→下）**: ペン → 消しゴム → 太さスライダー（アクティブツールに応じて表示/値切替）→ **全消去** → **ダウンロード**。\[要確認]
   * **表示**: 現在選択ツールの可視化（ハイライト・ARIA属性）。
   * **サイズ**: 最小タップターゲット 44×44px、ツールバー幅 72–88px \[要確認]。
   * **振る舞い**: ビューポート幅が狭い場合は **折りたたみ（アイコンのみ）** し、ホバー/タップでスライダーを展開 \[Should]。
4. **キャンバス全消去（クリア）**

   * 左側ツールバー内のボタンで実行。
   * 誤操作防止の確認ダイアログ（「キャンバスをすべて消去します。よろしいですか？」）\[要確認]。
   * 取り消し（Undo）は対象外（今回）。
5. **画像のダウンロード（PNGエクスポート）**

   * 左側ツールバー内のボタンで実行。
   * 透過背景を保持して PNG 形式で保存。
   * 画像のピクセル寸法は **キャンバスの内部解像度** に一致（CSSスケールに依存しない）。
   * 既定ファイル名: `paint-YYYYMMDD-HHMMSS.png` \[要確認]。
   * ボタン押下で即時ダウンロード（サーバ送信なし）。
6. **キャンバス解像度最適化**

   * `devicePixelRatio` を考慮した内部解像度設定（高DPI対応）。
7. **基本ショートカット**

   * `P`=ペン、`E`=消しゴム、`C`=クリア、`Ctrl/Cmd+S`=保存（ブラウザの保存ダイアログと競合時は上書き）\[要確認]。

### 5.2 Should（望ましい）

1. **キャンバスサイズ選択**: S(800×600)/M(1280×720)/L(1920×1080) プリセット（左側ツールバー下部に折りたたみセクションとして配置）。
2. **最後の設定の保持**: ローカルストレージでツール・太さ・直近キャンバスサイズを保存。
3. **ツールバー表示切替**: `T` キーで表示/非表示トグル（キャンバスを広く使いたい場合）。

### 5.3 Could（あれば便利）

* カラーピッカー（ペン色変更）。
* Undo/Redo（直近10手）—パフォーマンス検証が前提。
* キャンバスのドラッグスクロール/ピンチズーム。

### 5.4 Won’t（今回はやらない）

* レイヤー、図形、テキスト、共同編集、サーバ連携、マルチタブ同期。

## 6. 非機能要件（仮置き）

* **性能**: 1920×1080 で 60fps 相当の追従性（体感）。長押し/高速ストロークでの欠落なし。
* **互換性**: 最新の Chrome/Edge/Safari/Firefox の現行・前バージョン。IE非対応。
* **入力デバイス**: マウス/タッチ/ペン（筆圧=未対応、将来検討）。
* **アクセシビリティ**: キーボード操作（Tab/矢印/Enter）でツール選択可能。ツールバーに `role="toolbar"`、ツールボタンに `aria-pressed` を付与。フォーカスリングはWCAGに準拠。
* **セキュリティ/プライバシー**: オフライン動作前提。画像はブラウザ内で処理、サーバ送信なし。
* **可用性/運用**: 単一HTMLで配布可能（CDN不要）\[要確認]。バージョン表示とフィードバック導線。
* **レスポンシブ**: 横幅が狭い場合、ツールバーをアイコン最小化。最小キャンバス表示領域は 640×360 を確保 \[要確認]。

## 7. UI/画面仕様（レイアウト）

* **レイアウト**: `CSS Grid` もしくは `flex` により、**左: ツールバー固定 / 右: キャンバス（自動拡張）** の2カラム。
* **左側ツールバー**:

  * 幅: 72–88px（可変）\[要確認]、背景は淡色、アイコン+ラベル（折りたたみ時はアイコンのみ）。
  * ボタン: ペン / 消しゴム / 太さスライダー / **全消去** / **ダウンロード**。
  * 太さスライダー: 垂直スライダー、値はプレビューリングに反映。
  * 重要操作（全消去・ダウンロード）は下部に固定位（誤タップ防止）。
* **キャンバス領域**: 余白を確保し、リサイズ時は **内容を保持**（内部バッファへ描画→リサイズ後に再描画）\[Should]。MVPではリセットでも可 \[要確認]。
* **カーソル**: 現在の太さに応じた円形プレビュー（クロスヘア中心）。
* **通知/ダイアログ**: クリア確認ダイアログ、保存完了トースト（"保存しました"）。

## 8. 技術要件（仮）

* **構成**: 単一HTML（`index.html`）+ 内蔵JS/CSS（もしくは `app.js`/`style.css` 分離）。
* **API**: HTML5 Canvas 2D、Pointer Events、`requestAnimationFrame`。
* **描画**: ストローク時の補間（直線補間 + オプションの二次ベジェ簡易化）。
* **高DPI対応**: `canvas.width/height` を CSS サイズ×`devicePixelRatio` に設定し、描画座標をスケール。
* **消しゴム**: `globalCompositeOperation = 'destination-out'`（背景透過）; 代替として背景色上書きモードを設定で切替可能 \[Should]。
* **状態管理**: 単純なオブジェクト（`state = {tool, penSize, eraserSize}`）。
* **エクスポート**: `canvas.toBlob('image/png')` でダウンロード（非同期）。
* **レイアウト実装**: `aside.toolbar`（左固定） + `main.canvas`。モバイル時は `position: sticky` or `fixed` を用いて折りたたみ。

## 9. データ仕様

* **既定キャンバス**: 1280×720（CSS）、内部 1280×720×`devicePixelRatio`。
* **色**: 黒 (#000000)。背景: 透明（チェッカー表示は行わない）\[要確認]。
* **ファイル形式**: PNG（透過）、JPEG非対応（今回は）。

## 10. 受け入れ基準（MVP完了の定義）

* [ ] デスクトップChrome最新で、ペン/消しゴム/**クリア**/**保存**が動作する。
* [ ] **左側ツールバー**が表示され、**ペン/消しゴム/太さスライダー/全消去/ダウンロード**が縦並びで操作できる。
* [ ] ペン太さを 1–30 px で変更し、その太さ通りに描画される。
* [ ] **クリア**実行時、確認ダイアログ後に全消去される（キャンバスが完全に透明になる）。
* [ ] **保存**でダウンロードされるPNGは透過背景を保持し、キャンバス内部解像度と一致する。
* [ ] 高DPIディスプレイでも線がボケない（拡大表示で確認）。
* [ ] マウス/タッチの両方で連続ストロークが途切れない。
* [ ] 1ファイル（HTML+内蔵JS/CSS）で配布・動作する。

## 11. 制約・前提

* **技術**: フレームワーク不使用（Vanilla JS）\[要確認]。
* **ネットワーク**: オフラインでも動作。
* **法令/ライセンス**: 依存ライブラリがあればOSSライセンスを明示（現状なし）。

## 12. リスクと対策（批判的観点）

* **R1: 入力イベントの端末差**（タッチ端末のパームリジェクション/筆圧）→ 最小限定: Pointer Eventsのみ、筆圧は無視。タブレット検証を初期に実施。
* **R2: 画像の大サイズ化でのパフォーマンス低下** → 既定サイズを中程度に固定、ズーム/Undoは後回し。
* **R3: 消しゴム仕様の合意不足**（透明化 vs 背景色上書き）→ MVPは透明化で固定、設定切替はShould。
* \*\*R4: **左側ツールバーによる描画領域の狭小化** → 折りたたみ/非表示トグル（`T`）とミニモードで緩和。
* **R5: 保存仕様の齟齬**（背景色/サイズ/ファイル名）→ 受け入れ基準で具体化、E2Eテストで確認。

## 13. テスト計画（要点）

* **ブラウザ互換**: Chrome/Edge/Safari/Firefoxの現行+前バージョンでスモーク。
* **入力**: マウス、タッチ（iPad/Android）、ペン（Wacom/Apple Pencilはベストエフォート）。
* **画質**: devicePixelRatio=1/2/3でエッジのにじみを確認。
* **保存**: 透明PNGのαが消しゴムで正しく抜けているかをビューワで検証。ダウンロード画像のピクセル寸法を検査。
* **UI**: 左側ツールバーのキーボード操作順、フォーカス可視性、折りたたみ挙動を確認。

## 14. マイルストーン（仮案）

* **M1**: 骨組み（キャンバス/描画ループ/高DPI）
* **M2**: ペン/消しゴム/太さUI
* **M3**: **左側ツールバー実装** + **クリア**/ショートカット/基本スタイル
* **M4**: **保存（PNG）**/互換性テスト
* **M5**: ドキュメント整備/受け入れ判定

## 15. 変更管理・承認

* 要件変更はPRD差分で管理。合意はレビューコメントのResolveで記録。

---

### 未確定事項（要確認リスト）

* [ ] ツールバー幅（72/80/88pxなど）と折りたたみの閾値（<= 768px など）。
* [ ] ボタンの**順序**と**固定位置**（全消去/ダウンロードを下部固定で確定か）。
* [ ] クリア時の確認ダイアログ文言/有無。
* [ ] 保存時の**背景**（完全透明で確定か、白背景オプションを持つか）。
* [ ] 保存時の**解像度**（内部解像度固定で確定か、エクスポートスケールを設けるか）。
* [ ] ショートカット `Ctrl/Cmd+S` の扱い（ブラウザ標準動作との競合をどうするか）。

> 本変更により、**ツール選択／ダウンロード／全消去は画面左側のツールバーに集約** されることを明文化しました。承認後に v0.4 として確定版に更新します。
