# ペイントアプリ（HTML版）要件定義書 v0.4（叩き台・更新：左側ツールバー＋10色＆フレームワーク）

---

## 1. 背景・目的

* **目的**: ブラウザ上で動作するシンプルなペイントツールを提供し、手軽なラフスケッチや注釈用途を可能にする。
* **価値仮説**: インストール不要・軽量・学習コストが低いことで、社内外の素早いビジュアルコミュニケーションに貢献。

## 2. スコープ（範囲）

* **対象**: デスクトップ/タブレットの主要ブラウザでの手描きスケッチ。
* **含む**: ペンツール、消しゴムツール、ペン太さ変更、**10色のペンカラー選択**、**キャンバス全消去（クリア）**、**画像ダウンロード（PNGエクスポート）**、**左側ツールバーでの集約UI**。
* **含まない（今回）**: レイヤー、図形描画、テキスト、Undo/Redo、マルチページ、共同編集、サーバ保存。\[今後検討]

## 3. ペルソナ/主要ユースケース（仮）

* **ペルソナ**:

  * 企画・デザイナーがワイヤーのラフを描く
  * エンジニアが仕様の図を簡易に共有
* **ユースケース**:

  1. ペンで描く→消しゴムで修正→**保存（PNGダウンロード）**
  2. 会議中にタブレットでホワイトボード代替（終了時に**クリア**）

## 4. 用語定義（簡易）

* **キャンバス**: HTML5 `<canvas>` 2Dコンテキスト。
* **ペン**: 不透明の自由曲線描画。
* **消しゴム**: 描画済みピクセルの削除（透明化）または背景色での上書き。
* **左側ツールバー（サイドバー）**: 画面左端に固定された縦型操作領域。ツール切替・色選択・太さ調整・クリア・保存を集約。

## 5. 機能要件（MoSCoW）

### 5.1 Must（必須）

1. **ペンツールでの自由曲線描画**

   * 入力: マウス・タッチ・ペン（Pointer Events）。
   * **色**: **10色のプリセットから選択**（左ツールバーにスウォッチ表示）。
   * **太さ**: スライダーで 1–30 px（既定 4 px）。
   * 線の継ぎ目・端部: 丸型（round join/cap）。
2. **消しゴムツール**

   * 動作: **合成モード=destination-out** による透明消去（背景透過）。
   * **太さ**: スライダーで 5–50 px（既定 20 px）。
3. **左側ツールバーでの操作集約**

   * **配置**: 画面左端に固定。**ペン／消しゴム／カラー10色スウォッチ／太さスライダー／全消去／ダウンロード** を縦並びに配置。
   * **順序（上→下）**: ペン → 消しゴム → **カラー** → 太さスライダー → **全消去** → **ダウンロード**。
   * **表示**: 現在選択ツール・色の可視化（ハイライト・ARIA属性）。
   * **サイズ**: 最小タップターゲット 44×44px、ツールバー幅 72–88px。
4. **キャンバス全消去（クリア）**

   * 左側ツールバー内のボタンで実行。
   * 誤操作防止の確認ダイアログ（「キャンバスをすべて消去します。よろしいですか？」）。
   * 取り消し（Undo）は対象外（今回）。
5. **画像のダウンロード（PNGエクスポート）**

   * 左側ツールバー内のボタンで実行。
   * 透過背景を保持して PNG 形式で保存。
   * 画像のピクセル寸法は **キャンバスの内部解像度** に一致（CSSスケールに依存しない）。
   * 既定ファイル名: `paint-YYYYMMDD-HHMMSS.png`。
   * ボタン押下で即時ダウンロード（サーバ送信なし）。
6. **キャンバス解像度最適化**

   * `devicePixelRatio` を考慮した内部解像度設定（高DPI対応）。
7. **基本ショートカット**

   * `P`=ペン、`E`=消しゴム、`C`=クリア、`Ctrl/Cmd+S`=保存（ブラウザの保存ダイアログと競合時は上書き）。

### 5.2 Should（望ましい）

1. **キャンバスサイズ選択**: S(800×600)/M(1280×720)/L(1920×1080) プリセット（左側ツールバー下部に折りたたみセクションとして配置）。
2. **最後の設定の保持**: ローカルストレージでツール・太さ・直近キャンバスサイズ・直近色を保存。
3. **ツールバー表示切替**: `T` キーで表示/非表示トグル（キャンバスを広く使いたい場合）。

### 5.3 Could（あれば便利）

* カラーピッカー（任意の色指定）。
* Undo/Redo（直近10手）—パフォーマンス検証が前提。
* キャンバスのドラッグスクロール/ピンチズーム。

### 5.4 Won’t（今回はやらない）

* レイヤー、図形、テキスト、共同編集、サーバ連携、マルチタブ同期。

## 6. 非機能要件（仮置き）

* **性能**: 1920×1080 で 60fps 相当の追従性（体感）。長押し/高速ストロークでの欠落なし。
* **互換性**: 最新の Chrome/Edge/Safari/Firefox の現行・前バージョン。IE非対応。
* **入力デバイス**: マウス/タッチ/ペン（筆圧=未対応、将来検討）。
* **アクセシビリティ**: キーボード操作（Tab/矢印/Enter）でツール・色選択可能。ツールバーは `role="toolbar"`、選択色は `aria-pressed` で状態提示。コントラスト確保。
* **セキュリティ/プライバシー**: **サーバ不要**。画像はブラウザ内で処理、サーバ送信なし。
* **可用性/運用**: 単一HTML/静的ホスティングで配布可能（CDN不要）]。バージョン表示とフィードバック導線。
* **レスポンシブ**: 横幅が狭い場合、ツールバーをアイコン最小化。最小キャンバス表示領域は 640×360 を確保 。

## 7. UI/画面仕様（レイアウト）

* **レイアウト**: `CSS Grid` もしくは `flex` により、**左: ツールバー固定 / 右: キャンバス（自動拡張）** の2カラム。
* **左側ツールバー**:

  * 幅: 72–88px（可変）、背景は淡色、アイコン+ラベル（折りたたみ時はアイコンのみ）。
  * ボタン/要素: ペン / 消しゴム / **カラー10色スウォッチ（2列×5行）** / 太さスライダー / **全消去** / **ダウンロード**。
  * 太さスライダー: 垂直スライダー、値はプレビューリングに反映。
  * 重要操作（全消去・ダウンロード）は下部に固定位（誤タップ防止）。
* **キャンバス領域**: 余白を確保し、リサイズ時は **内容を保持**（内部バッファへ描画→リサイズ後に再描画）\[Should]。MVPではリセットでも可 
* **カーソル**: 現在の太さに応じた円形プレビュー（クロスヘア中心）。
* **通知/ダイアログ**: クリア確認ダイアログ、保存完了トースト（"保存しました"）。

## 8. 技術要件（仮）

* **構成**: **Svelte 5 + Vite（@sveltejs/vite-plugin-svelte）** を採用。サーバ不要の**クライアントサイドSPA**として構築。

  * 代替案: Vanilla JS（最小構成）/ **SolidJS 1.x + Vite**（同等のCSR構成）。
* **ビルド/配布**: `npm run build` で `dist/` に静的ファイルを出力し、任意の静的ホスティングに配置。
* **API**: HTML5 Canvas 2D、Pointer Events、`requestAnimationFrame`。
* **描画**: ストローク時の補間（直線補間 + オプションの二次ベジェ簡易化）。
* **高DPI対応**: `canvas.width/height` を CSS サイズ×`devicePixelRatio` に設定し、描画座標をスケール。
* **消しゴム**: `globalCompositeOperation = 'destination-out'`（背景透過）。
* **状態管理**: Svelteのランタイム状態で `tool, color, penSize, eraserSize` を持つ。
* **エクスポート**: `canvas.toBlob('image/png')` でダウンロード（非同期）。
* **依存環境**: Node.js LTS / npm or pnpm。ブラウザは現行+前バージョンをサポート。

## 9. データ仕様

* **既定キャンバス**: 1280×720（CSS）、内部 1280×720×`devicePixelRatio`。
* **色（10色プリセット）**: `#000000` 黒, `#ffffff` 白, `#e11d48` 赤系, `#f59e0b` オレンジ, `#eab308` 黄, `#22c55e` 緑, `#06b6d4` シアン, `#3b82f6` 青, `#8b5cf6` 紫, `#ec4899` ピンク。

  * 表示はスウォッチ、選択中はアウトライン強調。キーボードで左右/上下移動可能。
* **背景**: 透明（チェッカー表示は行わない）]。
* **ファイル形式**: PNG（透過）、JPEG非対応（今回は）。

## 10. 受け入れ基準（MVP完了の定義）

* [ ] デスクトップChrome最新で、ペン/消しゴム/**カラー10色**/**クリア**/**保存**が動作する。
* [ ] ペン太さを 1–30 px で変更し、その太さ・色通りに描画される。
* [ ] **クリア**実行時、確認ダイアログ後に全消去される（キャンバスが完全に透明）。
* [ ] **保存**でダウンロードされるPNGは透過背景を保持し、キャンバス内部解像度と一致する。
* [ ] 高DPIディスプレイでも線がボケない（拡大表示で確認）。
* [ ] マウス/タッチの両方で連続ストロークが途切れない。
* [ ] 1ファイル（静的ビルド）で配布・動作する（サーバ不要）。

## 11. 制約・前提

* **技術**: **フレームワーク使用可**（ただしサーバ不要・クライアントサイドのみ）。
* **ネットワーク**: オフラインでも動作。
* **法令/ライセンス**: 依存ライブラリがあればOSSライセンスを明示。

## 12. リスクと対策（批判的観点）

* **R1: 入力イベントの端末差**（タッチ端末のパームリジェクション/筆圧）→ 最小限定: Pointer Eventsのみ、筆圧は無視。タブレット検証を初期に実施。
* **R2: 画像の大サイズ化でのパフォーマンス低下** → 既定サイズを中程度に固定、ズーム/Undoは後回し。
* **R3: 消しゴム仕様の合意不足**（透明化 vs 背景色上書き）→ MVPは透明化で固定、設定切替はShould。
* **R4: 左側ツールバーによる描画領域の狭小化** → 折りたたみ/非表示トグル（`T`）とミニモードで緩和。
* **R5: 保存仕様の齟齬**（背景色/サイズ/ファイル名）→ 受け入れ基準で具体化、E2Eテストで確認。

## 13. テスト計画（要点）

* **ブラウザ互換**: Chrome/Edge/Safari/Firefoxの現行+前バージョンでスモーク。
* **入力**: マウス、タッチ（iPad/Android）、ペン（Wacom/Apple Pencilはベストエフォート）。
* **画質**: devicePixelRatio=1/2/3でエッジのにじみを確認。
* **保存**: 透明PNGのαが消しゴムで正しく抜けているかをビューワで検証。ダウンロード画像のピクセル寸法を検査。
* **UI**: 左側ツールバーのキーボード操作順、フォーカス可視性、折りたたみ挙動を確認。

## 14. マイルストーン（仮案）

* **M1**: 骨組み（キャンバス/描画ループ/高DPI）
* **M2**: ペン/消しゴム/太さUI
* **M3**: **左側ツールバー実装（カラー含む）** + **クリア**/ショートカット/基本スタイル
* **M4**: **保存（PNG）**/互換性テスト
* **M5**: ドキュメント整備/受け入れ判定

## 15. 変更管理・承認

* 要件変更はPRD差分で管理。合意はレビューコメントのResolveで記録。

---
